tinymce.PluginManager.add("media",function(n,t){function u(n){return n.indexOf(".mp3")!=-1?"audio/mpeg":n.indexOf(".wav")!=-1?"audio/wav":n.indexOf(".mp4")!=-1?"video/mp4":n.indexOf(".webm")!=-1?"video/webm":n.indexOf(".ogg")!=-1?"video/ogg":n.indexOf(".swf")!=-1?"application/x-shockwave-flash":""}function i(t){var r=n.settings.media_scripts,i;if(r)for(i=0;i<r.length;i++)if(t.indexOf(r[i].filter)!==-1)return r[i]}function f(){function s(n){var e,o,t,r;e=i.find("#width")[0];o=i.find("#height")[0];t=e.value();r=o.value();i.find("#constrain")[0].checked()&&u&&f&&t&&r&&(n.control==e?(r=Math.round(t/u*r),o.value(r)):(t=Math.round(r/f*t),e.value(t)));u=t;f=r}var i,u,f,t,o=[{name:"source1",type:"filepicker",filetype:"media",size:40,autofocus:!0,label:"Source"}];n.settings.media_alt_source!==!1&&o.push({name:"source2",type:"filepicker",filetype:"media",size:40,label:"Alternative source"});n.settings.media_poster!==!1&&o.push({name:"poster",type:"filepicker",filetype:"image",size:40,label:"Poster"});n.settings.media_dimensions!==!1&&o.push({type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:3,size:3,onchange:s},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:3,size:3,onchange:s},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]});t=c(n.selection.getNode());u=t.width;f=t.height;i=n.windowManager.open({title:"Insert/edit video",data:t,bodyType:"tabpanel",body:[{title:"General",type:"form",onShowTab:function(){t=r(this.next().find("#embed").value());this.fromJSON(t)},items:o},{title:"Embed",type:"panel",layout:"flex",direction:"column",align:"stretch",padding:10,spacing:10,onShowTab:function(){this.find("#embed").value(e(this.parent().toJSON()))},items:[{type:"label",text:"Paste your embed code below:",forId:"mcemediasource"},{id:"mcemediasource",type:"textbox",flex:1,name:"embed",value:h(),multiline:!0,label:"Source"}]}],onSubmit:function(){n.insertContent(e(this.toJSON()))}})}function h(){var t=n.selection.getNode();if(t.getAttribute("data-mce-object"))return n.selection.getContent()}function e(f){var e="",h;return!f.source1&&(tinymce.extend(f,r(f.embed)),!f.source1)?"":(f.source2||(f.source2=""),f.poster||(f.poster=""),f.source1=n.convertURL(f.source1,"source"),f.source2=n.convertURL(f.source2,"source"),f.source1mime=u(f.source1),f.source2mime=u(f.source2),f.poster=n.convertURL(f.poster,"poster"),f.flashPlayerUrl=n.convertURL(t+"/moxieplayer.swf","movie"),tinymce.each(s,function(n){var r,t,i;if(r=n.regex.exec(f.source1)){for(i=n.url,t=0;r[t];t++)i=i.replace("$"+t,function(){return r[t]});f.source1=i;f.type=n.type;f.width=f.width||n.w;f.height=f.height||n.h}}),f.embed?e=o(f.embed,f,!0):(h=i(f.source1),h&&(f.type="script",f.width=h.width,f.height=h.height),f.width=f.width||300,f.height=f.height||150,tinymce.each(f,function(t,i){f[i]=n.dom.encode(t)}),f.type=="iframe"?e+='<iframe src="'+f.source1+'" width="'+f.width+'" height="'+f.height+'"><\/iframe>':f.source1mime=="application/x-shockwave-flash"?(e+='<object data="'+f.source1+'" width="'+f.width+'" height="'+f.height+'" type="application/x-shockwave-flash">',f.poster&&(e+='<img src="'+f.poster+'" width="'+f.width+'" height="'+f.height+'" />'),e+="<\/object>"):f.source1mime.indexOf("audio")!=-1?n.settings.audio_template_callback?e=n.settings.audio_template_callback(f):e+='<audio controls="controls" src="'+f.source1+'">'+(f.source2?'\n<source src="'+f.source2+'"'+(f.source2mime?' type="'+f.source2mime+'"':"")+" />\n":"")+"<\/audio>":f.type=="script"?e+='<script src="'+f.source1+'"><\/script>':e=n.settings.video_template_callback?n.settings.video_template_callback(f):'<video width="'+f.width+'" height="'+f.height+'"'+(f.poster?' poster="'+f.poster+'"':"")+' controls="controls">\n<source src="'+f.source1+'"'+(f.source1mime?' type="'+f.source1mime+'"':"")+" />\n"+(f.source2?'<source src="'+f.source2+'"'+(f.source2mime?' type="'+f.source2mime+'"':"")+" />\n":"")+"<\/video>"),e)}function r(n){var t={};return new tinymce.html.SaxParser({validate:!1,allow_conditional_comments:!0,special:"script,noscript",start:function(n,r){if(t.source1||n!="param"||(t.source1=r.map.movie),(n=="iframe"||n=="object"||n=="embed"||n=="video"||n=="audio")&&(t.type||(t.type=n),t=tinymce.extend(r.map,t)),n=="script"){var u=i(r.map.src);if(!u)return;t={type:"script",source1:r.map.src,width:u.width,height:u.height}}n=="source"&&(t.source1?t.source2||(t.source2=r.map.src):t.source1=r.map.src);n!="img"||t.poster||(t.poster=r.map.src)}}).parse(n),t.source1=t.source1||t.src||t.data,t.source2=t.source2||"",t.poster=t.poster||"",t}function c(t){return t.getAttribute("data-mce-object")?r(n.serializer.serialize(t,{selection:!0})):{}}function o(n,t,i){function u(n,t){var i,u,r,f;for(i in t)if(r=""+t[i],n.map[i])for(u=n.length;u--;)f=n[u],f.name==i&&(r?(n.map[i]=r,f.value=r):(delete n.map[i],n.splice(u,1)));else r&&(n.push({name:i,value:r}),n.map[i]=r)}var r=new tinymce.html.Writer,f=0,e;return new tinymce.html.SaxParser({validate:!1,allow_conditional_comments:!0,special:"script,noscript",comment:function(n){r.comment(n)},cdata:function(n){r.cdata(n)},text:function(n,t){r.text(n,t)},start:function(n,o,s){switch(n){case"video":case"object":case"embed":case"img":case"iframe":u(o,{width:t.width,height:t.height})}if(i)switch(n){case"video":u(o,{poster:t.poster,src:""});t.source2&&u(o,{src:""});break;case"iframe":u(o,{src:t.source1});break;case"source":if(f++,f<=2&&(u(o,{src:t["source"+f],type:t["source"+f+"mime"]}),!t["source"+f]))return;break;case"img":if(!t.poster)return;e=!0}r.start(n,o,s)},end:function(n){var o,s,h;if(n=="video"&&i)for(o=1;o<=2;o++)t["source"+o]&&(s=[],s.map={},f<o&&(u(s,{src:t["source"+o],type:t["source"+o+"mime"]}),r.start("source",s,!0)));t.poster&&n=="object"&&i&&!e&&(h=[],h.map={},u(h,{src:t.poster,width:t.width,height:t.height}),r.start("img",h,!0));r.end(n)}},new tinymce.html.Schema({})).parse(n),r.getContent()}var s=[{regex:/youtu\.be\/([\w\-.]+)/,type:"iframe",w:425,h:350,url:"//www.youtube.com/embed/$1"},{regex:/youtube\.com(.+)v=([^&]+)/,type:"iframe",w:425,h:350,url:"//www.youtube.com/embed/$2"},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc"},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed"'}];n.on("ResolveName",function(n){var t;n.target.nodeType==1&&(t=n.target.getAttribute("data-mce-object"))&&(n.name=t)});n.on("preInit",function(){var r=n.schema.getSpecialElements(),t;tinymce.each("video audio iframe object".split(" "),function(n){r[n]=new RegExp("<\/"+n+"[^>]*>","gi")});t=n.schema.getBoolAttrs();tinymce.each("webkitallowfullscreen mozallowfullscreen allowfullscreen".split(" "),function(n){t[n]={}});n.parser.addNodeFilter("iframe,video,audio,object,embed,script",function(t,r){for(var a=t.length,s,u,e,f,h,c,l,o;a--;)if((u=t[a],u.parent)&&(u.name!="script"||(o=i(u.attr("src")),o))){for(e=new tinymce.html.Node("img",1),e.shortEnded=!0,o&&(o.width&&u.attr("width",o.width.toString()),o.height&&u.attr("height",o.height.toString())),c=u.attributes,s=c.length;s--;)f=c[s].name,h=c[s].value,f!=="width"&&f!=="height"&&f!=="style"&&((f=="data"||f=="src")&&(h=n.convertURL(h,f)),e.attr("data-mce-p-"+f,h));l=u.firstChild&&u.firstChild.value;l&&(e.attr("data-mce-html",escape(l)),e.firstChild=null);e.attr({width:u.attr("width")||"300",height:u.attr("height")||(r=="audio"?"30":"150"),style:u.attr("style"),src:tinymce.Env.transparentSrc,"data-mce-object":r,"class":"mce-object mce-object-"+r});u.replace(e)}});n.serializer.addAttributeFilter("data-mce-object",function(n,t){for(var c=n.length,i,r,f,e,s,o,u,h;c--;)if(i=n[c],i.parent){for(u=i.attr(t),r=new tinymce.html.Node(u,1),u!="audio"&&u!="script"&&r.attr({width:i.attr("width"),height:i.attr("height")}),r.attr({style:i.attr("style")}),e=i.attributes,f=e.length;f--;)h=e[f].name,h.indexOf("data-mce-p-")===0&&r.attr(h.substr(11),e[f].value);u=="script"&&r.attr("type","text/javascript");s=i.attr("data-mce-html");s&&(o=new tinymce.html.Node("#text",3),o.raw=!0,o.value=unescape(s),r.append(o));i.replace(r)}})});n.on("ObjectSelected",function(n){var t=n.target.getAttribute("data-mce-object");(t=="audio"||t=="script")&&n.preventDefault()});n.on("objectResized",function(n){var i=n.target,t;i.getAttribute("data-mce-object")&&(t=i.getAttribute("data-mce-html"),t&&(t=unescape(t),i.setAttribute("data-mce-html",escape(o(t,{width:n.width,height:n.height})))))});n.addButton("media",{tooltip:"Insert/edit video",onclick:f,stateSelector:["img[data-mce-object=video]","img[data-mce-object=iframe]"]});n.addMenuItem("media",{icon:"media",text:"Insert video",onclick:f,context:"insert",prependToContext:!0})});
/*
//# sourceMappingURL=plugin.min.js.map
*/