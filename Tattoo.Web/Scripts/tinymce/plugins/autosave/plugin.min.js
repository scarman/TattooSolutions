tinymce.PluginManager.add("autosave",function(n){function h(n,t){return n=/^(\d+)([ms]?)$/.exec(""+(n||t)),(n[2]?{s:1e3,m:6e4}[n[2]]:1)*parseInt(n,10)}function u(){var n=parseInt(r.getItem(t+"time"),10)||0;return(new Date).getTime()-n>i.autosave_retention?(f(!1),!1):!0}function f(i){r.removeItem(t+"draft");r.removeItem(t+"time");i!==!1&&n.fire("RemoveDraft")}function c(){!o()&&n.isDirty()&&(r.setItem(t+"draft",n.getContent({format:"raw",no_events:!0})),r.setItem(t+"time",(new Date).getTime()),n.fire("StoreDraft"))}function e(){u()&&(n.setContent(r.getItem(t+"draft"),{format:"raw"}),n.fire("RestoreDraft"))}function v(){s||(setInterval(function(){n.removed||c()},i.autosave_interval),s=!0)}function l(){var t=this;t.disabled(!u());n.on("StoreDraft RestoreDraft RemoveDraft",function(){t.disabled(!u())});v()}function a(){n.undoManager.beforeChange();e();f();n.undoManager.add()}function y(){var n;return tinymce.each(tinymce.editors,function(t){t.plugins.autosave&&t.plugins.autosave.storeDraft();!n&&t.isDirty()&&t.getParam("autosave_ask_before_unload",!0)&&(n=t.translate("You have unsaved changes are you sure you want to navigate away?"))}),n}function o(t){var i=n.settings.forced_root_block;return t=tinymce.trim(typeof t=="undefined"?n.getBody().innerHTML:t),t===""||new RegExp("^<"+i+"[^>]*>(( |&nbsp;|[ \t]|<br[^>]*>)+?|)<\/"+i+">|<br>$","i").test(t)}var i=n.settings,r=tinymce.util.LocalStorage,t,s;if(t=i.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-",t=t.replace(/\{path\}/g,document.location.pathname),t=t.replace(/\{query\}/g,document.location.search),t=t.replace(/\{id\}/g,n.id),i.autosave_interval=h(i.autosave_interval,"30s"),i.autosave_retention=h(i.autosave_retention,"20m"),n.addButton("restoredraft",{title:"Restore last draft",onclick:a,onPostRender:l}),n.addMenuItem("restoredraft",{text:"Restore last draft",onclick:a,onPostRender:l,context:"file"}),n.settings.autosave_restore_when_empty!==!1){n.on("init",function(){u()&&o()&&e()});n.on("saveContent",function(){f()})}window.onbeforeunload=y;this.hasDraft=u;this.storeDraft=c;this.restoreDraft=e;this.removeDraft=f;this.isEmpty=o});
/*
//# sourceMappingURL=plugin.min.js.map
*/