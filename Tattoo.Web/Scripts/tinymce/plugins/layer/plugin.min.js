tinymce.PluginManager.add("layer",function(n){function t(n){do if(n.className&&n.className.indexOf("mceItemLayer")!=-1)return n;while(n=n.parentNode)}function r(t){var i=n.dom;tinymce.each(i.select("div,p",t),function(n){/^(absolute|relative|fixed)$/i.test(n.style.position)&&(n.hasVisual?i.addClass(n,"mceItemVisualAid"):i.removeClass(n,"mceItemVisualAid"),i.addClass(n,"mceItemLayer"))})}function i(i){var r,u=[],s=t(n.selection.getNode()),f=-1,o=-1,e;for(e=[],tinymce.walk(n.getBody(),function(n){n.nodeType==1&&/^(absolute|relative|static)$/i.test(n.style.position)&&e.push(n)},"childNodes"),r=0;r<e.length;r++)u[r]=e[r].style.zIndex?parseInt(e[r].style.zIndex,10):0,f<0&&e[r]==s&&(f=r);if(i<0){for(r=0;r<u.length;r++)if(u[r]<u[f]){o=r;break}o>-1?(e[f].style.zIndex=u[o],e[o].style.zIndex=u[f]):u[f]>0&&(e[f].style.zIndex=u[f]-1)}else{for(r=0;r<u.length;r++)if(u[r]>u[f]){o=r;break}o>-1?(e[f].style.zIndex=u[o],e[o].style.zIndex=u[f]):e[f].style.zIndex=u[f]+1}n.execCommand("mceRepaint")}function u(){var t=n.dom,i=t.getPos(t.getParent(n.selection.getNode(),"*")),r=n.getBody();n.dom.add(r,"div",{style:{position:"absolute",left:i.x,top:i.y>20?i.y:20,width:100,height:100},"class":"mceItemVisualAid mceItemLayer"},n.selection.getContent()||n.getLang("layer.content"));tinymce.Env.ie&&t.setHTML(r,r.innerHTML)}function f(){var i=t(n.selection.getNode());i||(i=n.dom.getParent(n.selection.getNode(),"DIV,P,IMG"));i&&(i.style.position.toLowerCase()=="absolute"?(n.dom.setStyles(i,{position:"",left:"",top:"",width:"",height:""}),n.dom.removeClass(i,"mceItemVisualAid"),n.dom.removeClass(i,"mceItemLayer")):(i.style.left||(i.style.left="20px"),i.style.top||(i.style.top="20px"),i.style.width||(i.style.width=i.width?i.width+"px":"100px"),i.style.height||(i.style.height=i.height?i.height+"px":"100px"),i.style.position="absolute",n.dom.setAttrib(i,"data-mce-style",""),n.addVisual(n.getBody())),n.execCommand("mceRepaint"),n.nodeChanged())}n.addCommand("mceInsertLayer",u);n.addCommand("mceMoveForward",function(){i(1)});n.addCommand("mceMoveBackward",function(){i(-1)});n.addCommand("mceMakeAbsolute",function(){f()});n.addButton("moveforward",{title:"layer.forward_desc",cmd:"mceMoveForward"});n.addButton("movebackward",{title:"layer.backward_desc",cmd:"mceMoveBackward"});n.addButton("absolute",{title:"layer.absolute_desc",cmd:"mceMakeAbsolute"});n.addButton("insertlayer",{title:"layer.insertlayer_desc",cmd:"mceInsertLayer"});n.on("init",function(){tinymce.Env.ie&&n.getDoc().execCommand("2D-Position",!1,!0)});n.on("mouseup",function(i){var r=t(i.target);r&&n.dom.setAttrib(r,"data-mce-style","")});n.on("mousedown",function(i){var r=i.target,u=n.getDoc(),f;tinymce.Env.gecko&&(t(r)?u.designMode!=="on"&&(u.designMode="on",r=u.body,f=r.parentNode,f.removeChild(r),f.appendChild(r)):u.designMode=="on"&&(u.designMode="off"))});n.on("NodeChange",r)});
/*
//# sourceMappingURL=plugin.min.js.map
*/