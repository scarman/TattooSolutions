(function(n,t){"use strict";function u(n,t){for(var u,e=[],r=0;r<n.length;++r){if(u=i[n[r]]||f(n[r]),!u)throw"module definition dependecy not found: "+n[r];e.push(u)}t.apply(null,e)}function r(n,r,f){if(typeof n!="string")throw"invalid module definition, module id must be defined and be a string";if(r===t)throw"invalid module definition, dependencies must be specified";if(f===t)throw"invalid module definition, definition function must be specified";u(r,function(){i[n]=f.apply(null,arguments)})}function f(t){for(var i=n,u=t.split(/[.\/]/),r=0;r<u.length;++r){if(!i[u[r]])return;i=i[u[r]]}return i}function e(r){for(var f,o=0;o<r.length;o++){var e=n,s=r[o],u=s.split(/[.\/]/);for(f=0;f<u.length-1;++f)e[u[f]]===t&&(e[u[f]]={}),e=e[u[f]];e[u[u.length-1]]=i[s]}}var i={};r("tinymce/spellcheckerplugin/DomTextMatcher",[],function(){return function(n,t){function p(n,t){if(!n[0])throw"findAndReplaceDOMText cannot handle zero-length matches";return{start:n.index,end:n.index+n[0].length,text:n[0],data:t}}function l(n){var t;if(n.nodeType===3)return n.data;if(e[n.nodeName]&&!u[n.nodeName])return"";if(t="",(u[n.nodeName]||o[n.nodeName])&&(t+="\n"),n=n.firstChild)do t+=l(n);while(n=n.nextSibling);return t}function w(n,t,i){var h,c,v,l,a=[],s=0,r=n,f,y=0;t=t.slice(0);t.sort(function(n,t){return n.start-t.start});f=t.shift();n:for(;;){if((u[r.nodeName]||o[r.nodeName])&&s++,r.nodeType===3&&(!c&&r.length+s>=f.end?(c=r,l=f.end-s):h&&a.push(r),!h&&r.length+s>f.start&&(h=r,v=f.start-s),s+=r.length),h&&c){if(r=i({startNode:h,startNodeIndex:v,endNode:c,endNodeIndex:l,innerNodes:a,match:f.text,matchIndex:y}),s-=c.length-l,h=null,c=null,a=[],f=t.shift(),y++,!f)break}else if((!e[r.nodeName]||u[r.nodeName])&&r.firstChild){r=r.firstChild;continue}else if(r.nextSibling){r=r.nextSibling;continue}for(;;)if(r.nextSibling){r=r.nextSibling;break}else if(r.parentNode!==n)r=r.parentNode;else break n}}function b(n){function t(t,r){var u=i[r],f;return u.stencil||(u.stencil=n(u)),f=u.stencil.cloneNode(!1),f.setAttribute("data-mce-index",r),t&&f.appendChild(c.doc.createTextNode(t)),f}return function(n){var e,o,i,u=n.startNode,f=n.endNode,s=n.matchIndex,h=c.doc,r,v,w,b,l,k,a,y,p;if(u===f)return r=u,i=r.parentNode,n.startNodeIndex>0&&(e=h.createTextNode(r.data.substring(0,n.startNodeIndex)),i.insertBefore(e,r)),v=t(n.match,s),i.insertBefore(v,r),n.endNodeIndex<r.length&&(o=h.createTextNode(r.data.substring(n.endNodeIndex)),i.insertBefore(o,r)),r.parentNode.removeChild(r),v;for(e=h.createTextNode(u.data.substring(0,n.startNodeIndex)),o=h.createTextNode(f.data.substring(n.endNodeIndex)),w=t(u.data.substring(n.startNodeIndex),s),b=[],l=0,k=n.innerNodes.length;l<k;++l)a=n.innerNodes[l],y=t(a.data,s),a.parentNode.replaceChild(y,a),b.push(y);return p=t(f.data.substring(0,n.endNodeIndex),s),i=u.parentNode,i.insertBefore(e,u),i.insertBefore(w,u),i.removeChild(u),i=f.parentNode,i.insertBefore(p,f),i.insertBefore(o,f),i.removeChild(f),p}}function k(n){var t=n.parentNode;t.insertBefore(n.firstChild,n);n.parentNode.removeChild(n)}function s(t){var f=n.getElementsByTagName("*"),e=[],i,u,r;for(t=typeof t=="number"?""+t:null,i=0;i<f.length;i++)u=f[i],r=u.getAttribute("data-mce-index"),r!==null&&r.length&&(r===t||t===null)&&e.push(u);return e}function f(n){for(var t=i.length;t--;)if(i[t]===n)return t;return-1}function d(n){var t=[];return a(function(i,r){n(i,r)&&t.push(i)}),i=t,this}function a(n){for(var t=0,r=i.length;t<r;t++)if(n(i[t],t)===!1)break;return this}function g(t){return i.length&&w(n,i,b(t)),this}function nt(n,t){if(r&&n.global)while(h=n.exec(r))i.push(p(h,t));return this}function v(n){for(var i=s(n?f(n):null),t=i.length;t--;)k(i[t]);return this}function tt(n){return i[n.getAttribute("data-mce-index")]}function it(n){return s(f(n))[0]}function rt(n,t,u){return i.push({start:n,end:n+t,text:r.substr(n,t),data:u}),this}function y(n){var i=s(f(n)),r=t.dom.createRng();return r.setStartBefore(i[0]),r.setEndAfter(i[i.length-1]),r}function ut(n,i){var r=y(n);return r.deleteContents(),i.length>0&&r.insertNode(t.dom.doc.createTextNode(i)),r}function ft(){return i.splice(0,i.length),v(),this}var h,i=[],r,c=t.dom,u,e,o;return u=t.schema.getBlockElements(),e=t.schema.getWhiteSpaceElements(),o=t.schema.getShortEndedElements(),r=l(n),{text:r,matches:i,each:a,filter:d,reset:ft,matchFromElement:tt,elementFromMatch:it,find:nt,add:rt,wrap:g,unwrap:v,replace:ut,rangeFromMatch:y,indexOf:f}}});r("tinymce/spellcheckerplugin/Plugin",["tinymce/spellcheckerplugin/DomTextMatcher","tinymce/PluginManager","tinymce/util/Tools","tinymce/ui/Menu","tinymce/dom/DOMUtils","tinymce/util/XHR","tinymce/util/URI","tinymce/util/JSON"],function(n,t,i,r,u,f,e,o){t.add("spellchecker",function(t,s){function p(){return v.textMatcher||(v.textMatcher=new n(t.getBody(),t)),v.textMatcher}function ut(n,t){var r=[];return i.each(t,function(n){r.push({selectable:!0,text:n.name,data:n.value})}),r}function et(n){for(var t in n)return!1;return!0}function ot(n,f){var o=[],l=d[n];i.each(l,function(n){o.push({text:n,onclick:function(){t.insertContent(t.dom.encode(n));t.dom.remove(f);w()}})});o.push({text:"-"});g&&o.push({text:"Add to Dictionary",onclick:function(){ht(n,f)}});o.push.apply(o,[{text:"Ignore",onclick:function(){it(n,f)}},{text:"Ignore all",onclick:function(){it(n,f,!0)}},{text:"Finish",onclick:y}]);c=new r({items:o,context:"contextmenu",onautohide:function(n){n.target.className.indexOf("spellchecker")!=-1&&n.preventDefault()},onhide:function(){c.remove();c=null}});c.renderTo(document.body);var h=u.DOM.getPos(t.getContentAreaContainer()),s=t.dom.getPos(f[0]),e=t.dom.getRoot();e.nodeName=="BODY"?(s.x-=e.ownerDocument.documentElement.scrollLeft||e.scrollLeft,s.y-=e.ownerDocument.documentElement.scrollTop||e.scrollTop):(s.x-=e.scrollLeft,s.y-=e.scrollTop);h.x+=s.x;h.y+=s.y;c.moveTo(h.x,h.y+f[0].offsetHeight)}function nt(){return t.getParam("spellchecker_wordchar_pattern")||new RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`§©«®±¶·¸»¼½¾¿×÷¤”“„]+',"g")}function st(n,t,r,u){var c={method:n},l="";n=="spellcheck"&&(c.text=t,c.lang=h.spellchecker_language);n=="addToDictionary"&&(c.word=t);i.each(c,function(n,t){l&&(l+="&");l+=t+"="+encodeURIComponent(n)});f.send({url:new e(s).toAbsolute(h.spellchecker_rpc_url),type:"post",content_type:"application/x-www-form-urlencoded",data:l,success:function(n){n=o.parse(n);n?n.error?u(n.error):r(n):u("Sever response wasn't proper JSON.")},error:function(n,t){u("Spellchecker request error: "+t.status)}})}function tt(n,t,i,r){var u=h.spellchecker_callback||st;u.call(v,n,t,i,r)}function k(){function n(n){var i;if(n.words?(g=!!n.dictionary,i=n.words):i=n,t.setProgressState(!1),et(i)){t.windowManager.alert("No misspellings found");l=!1;return}d=i;p().find(nt()).filter(function(n){return!!i[n.text]}).wrap(function(n){return t.dom.create("span",{"class":"mce-spellchecker-word","data-mce-bogus":1,"data-mce-word":n.text})});t.fire("SpellcheckStart")}function i(n){t.windowManager.alert(n);t.setProgressState(!1);y()}if(l){y();return}y();l=!0;t.setProgressState(!0);tt("spellcheck",p().text,n,i);t.focus()}function w(){t.dom.select("span.mce-spellchecker-word").length||y()}function ht(n,i){t.setProgressState(!0);tt("addToDictionary",n,function(){t.setProgressState(!1);t.dom.remove(i,!0);w()},function(n){t.windowManager.alert(n);t.setProgressState(!1)})}function it(n,r,u){t.selection.collapse();u?i.each(t.dom.select("span.mce-spellchecker-word"),function(i){i.getAttribute("data-mce-word")==n&&t.dom.remove(i,!0)}):t.dom.remove(r,!0);w()}function y(){p().reset();v.textMatcher=null;l&&(l=!1,t.fire("SpellcheckEnd"))}function rt(n){var t=n.getAttribute("data-mce-index");return typeof t=="number"?""+t:t}function ct(n){var r,e=[],u,f;if(r=i.toArray(t.getBody().getElementsByTagName("span")),r.length)for(u=0;u<r.length;u++)(f=rt(r[u]),f!==null&&f.length)&&f===n.toString()&&e.push(r[u]);return e}function lt(n){var t=h.spellchecker_language;n.control.items().each(function(n){n.active(n.settings.data===t)})}var b,v=this,d,l,c,h=t.settings,g,ft=h.spellchecker_languages||"English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv",a;b=ut("Language",i.map(ft.split(","),function(n){var t=n.split("=");return{name:t[0],value:t[1]}}));t.on("click",function(n){var u=n.target,i,r;u.className=="mce-spellchecker-word"&&(n.preventDefault(),i=ct(rt(u)),i.length>0&&(r=t.dom.createRng(),r.setStartBefore(i[0]),r.setEndAfter(i[i.length-1]),t.selection.setRng(r),ot(u.getAttribute("data-mce-word"),i)))});t.addMenuItem("spellchecker",{text:"Spellcheck",context:"tools",onclick:k,selectable:!0,onPostRender:function(){var n=this;t.on("SpellcheckStart SpellcheckEnd",function(){n.active(l)})}});a={tooltip:"Spellcheck",onclick:k,onPostRender:function(){var n=this;t.on("SpellcheckStart SpellcheckEnd",function(){n.active(l)})}};b.length>1&&(a.type="splitbutton",a.menu=b,a.onshow=lt,a.onselect=function(n){h.spellchecker_language=n.control.settings.data});t.addButton("spellchecker",a);t.addCommand("mceSpellCheck",k);t.on("remove",function(){c&&(c.remove(),c=null)});t.on("change",w);this.getTextMatcher=p;this.getWordCharPattern=nt;this.getLanguage=function(){return h.spellchecker_language};h.spellchecker_language=h.spellchecker_language||h.language||"en"})});e(["tinymce/spellcheckerplugin/DomTextMatcher","tinymce/spellcheckerplugin/Plugin"])})(this);
/*
//# sourceMappingURL=plugin.min.js.map
*/