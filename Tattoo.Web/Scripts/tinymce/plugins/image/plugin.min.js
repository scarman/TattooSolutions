tinymce.PluginManager.add("image",function(n){function r(n,t){function u(n,r){i.parentNode&&i.parentNode.removeChild(i);t({width:n,height:r})}var i=document.createElement("img"),r;i.onload=function(){u(i.clientWidth,i.clientHeight)};i.onerror=function(){u()};r=i.style;r.visibility="hidden";r.position="fixed";r.bottom=r.left=0;r.width=r.height="auto";document.body.appendChild(i);i.src=n}function u(t){return tinymce.each(t,function(t){t.textStyle=function(){return n.formatter.getCssText({inline:"img",classes:[t.value]})}}),t}function t(t){return function(){var i=n.settings.image_list;typeof i=="string"?tinymce.util.XHR.send({url:i,success:function(n){t(tinymce.util.JSON.parse(n))}}):typeof i=="function"?i(t):t(i)}}function i(t){function b(t,r,u){var f,e=[];return tinymce.each(n.settings[t]||u,function(n){var t={text:n.text||n.title,value:n.value};e.push(t);(i[r]===n.value||!f&&n.selected)&&(f=t)}),f&&!i[r]&&(i[r]=f.value,f.selected=!0),e}function k(){function i(t,r){return r=r||[],tinymce.each(t,function(t){var u={text:t.text||t.title};t.menu?u.menu=i(t.menu):u.value=n.convertURL(t.value||t.url,"src");r.push(u)}),r}return i(t,[{text:"None",value:""}])}function a(){var i,r,n,t;i=o.find("#width")[0];r=o.find("#height")[0];n=i.value();t=r.value();o.find("#constrain")[0].checked()&&s&&h&&n&&t&&(s!=n?(t=Math.round(n/s*t),r.value(t)):(n=Math.round(t/h*n),i.value(n)));s=n;h=t}function p(){function t(t){function r(){t.onload=t.onerror=null;n.selection.select(t);n.nodeChanged()}t.onload=function(){i.width||i.height||e.setAttribs(t,{width:t.clientWidth,height:t.clientHeight});r()};t.onerror=r}w();a();i=tinymce.extend(i,o.toJSON());i.alt||(i.alt="");i.width===""&&(i.width=null);i.height===""&&(i.height=null);i.style||(i.style=null);i={src:i.src,alt:i.alt,width:i.width,height:i.height,style:i.style,"class":i["class"]};i["class"]||delete i["class"];n.undoManager.transact(function(){if(!i.src){f&&(e.remove(f),n.focus(),n.nodeChanged());return}f?e.setAttribs(f,i):(i.id="__mcenew",n.focus(),n.selection.setContent(e.createHTML("img",i)),f=e.get("__mcenew"),e.setAttrib(f,"id",null));t(f)})}function v(n){return n&&(n=n.replace(/px$/,"")),n}function d(){l&&l.value(n.convertURL(this.value(),"src"));r(this.value(),function(n){n.width&&n.height&&(s=n.width,h=n.height,o.find("#width").value(s),o.find("#height").value(h))})}function w(){function r(n){return n.length>0&&/^[0-9]+$/.test(n)&&(n+="px"),n}if(n.settings.image_advtab){var i=o.toJSON(),t=e.parseStyle(i.style);delete t.margin;t["margin-top"]=t["margin-bottom"]=r(i.vspace);t["margin-left"]=t["margin-right"]=r(i.hspace);t["border-width"]=r(i.border);o.find("#style").value(e.serializeStyle(e.parseStyle(e.serializeStyle(t))))}}var o,i={},e=n.dom,f=n.selection.getNode(),s,h,l,y,c;s=e.getAttrib(f,"width");h=e.getAttrib(f,"height");f.nodeName!="IMG"||f.getAttribute("data-mce-object")||f.getAttribute("data-mce-placeholder")?f=null:i={src:e.getAttrib(f,"src"),alt:e.getAttrib(f,"alt"),"class":e.getAttrib(f,"class"),width:s,height:h};t&&(l={type:"listbox",label:"Image list",values:k(),value:i.src&&n.convertURL(i.src,"src"),onselect:function(n){var t=o.find("#alt");(!t.value()||n.lastControl&&t.value()==n.lastControl.text())&&t.value(n.control.text());o.find("#src").value(n.control.value()).fire("change")},onPostRender:function(){l=this}});n.settings.image_class_list&&(y={name:"class",type:"listbox",label:"Class",values:u(b("image_class_list","class"))});c=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:d},l];n.settings.image_description!==!1&&c.push({name:"alt",type:"textbox",label:"Image description"});n.settings.image_dimensions!==!1&&c.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:a,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:a,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]});c.push(y);n.settings.image_advtab?(f&&(i.hspace=v(f.style.marginLeft||f.style.marginRight),i.vspace=v(f.style.marginTop||f.style.marginBottom),i.border=v(f.style.borderWidth),i.style=n.dom.serializeStyle(n.dom.parseStyle(n.dom.getAttrib(f,"style")))),o=n.windowManager.open({title:"Insert/edit image",data:i,bodyType:"tabpanel",body:[{title:"General",type:"form",items:c},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox"},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:w},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:p})):o=n.windowManager.open({title:"Insert/edit image",data:i,body:c,onSubmit:p})}n.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:t(i),stateSelector:"img:not([data-mce-object],[data-mce-placeholder])"});n.addMenuItem("image",{icon:"image",text:"Insert image",onclick:t(i),context:"insert",prependToContext:!0})});
/*
//# sourceMappingURL=plugin.min.js.map
*/