tinymce.PluginManager.add("fullpage",function(n){function e(){var t=o();n.windowManager.open({title:"Document properties",data:t,defaults:{type:"textbox",size:40},body:[{name:"title",label:"Title"},{name:"keywords",label:"Keywords"},{name:"description",label:"Description"},{name:"robots",label:"Robots"},{name:"author",label:"Author"},{name:"docencoding",label:"Encoding"}],onSubmit:function(n){s(tinymce.extend(t,n.data))}})}function o(){function e(n,t){var i=n.attr(t);return i||""}var u=f(),i={},t,o;return i.fontface=n.getParam("fullpage_default_fontface",""),i.fontsize=n.getParam("fullpage_default_fontsize",""),t=u.firstChild,t.type==7&&(i.xml_pi=!0,o=/encoding="([^"]+)"/.exec(t.value),o&&(i.docencoding=o[1])),t=u.getAll("#doctype")[0],t&&(i.doctype="<!DOCTYPE"+t.value+">"),t=u.getAll("title")[0],t&&t.firstChild&&(i.title=t.firstChild.value),r(u.getAll("meta"),function(n){var r=n.attr("name"),u=n.attr("http-equiv"),t;r?i[r.toLowerCase()]=n.attr("content"):u=="Content-Type"&&(t=/charset\s*=\s*(.*)\s*/gi.exec(n.attr("content")),t&&(i.docencoding=t[1]))}),t=u.getAll("html")[0],t&&(i.langcode=e(t,"lang")||e(t,"xml:lang")),i.stylesheets=[],tinymce.each(u.getAll("link"),function(n){n.attr("rel")=="stylesheet"&&i.stylesheets.push(n.attr("href"))}),t=u.getAll("body")[0],t&&(i.langdir=e(t,"dir"),i.style=e(t,"style"),i.visited_color=e(t,"vlink"),i.link_color=e(t,"link"),i.active_color=e(t,"alink")),i}function s(u){function h(n,t,i){n.attr(t,i?i:undefined)}function c(n){s.firstChild?s.insert(n,s.firstChild):s.append(n)}var o,s,a,e,v,y=n.dom,l;o=f();s=o.getAll("head")[0];s||(e=o.getAll("html")[0],s=new t("head",1),e.firstChild?e.insert(s,e.firstChild,!0):e.append(s));e=o.firstChild;u.xml_pi?(v='version="1.0"',u.docencoding&&(v+=' encoding="'+u.docencoding+'"'),e.type!=7&&(e=new t("xml",7),o.insert(e,o.firstChild,!0)),e.value=v):e&&e.type==7&&e.remove();e=o.getAll("#doctype")[0];u.doctype?(e||(e=new t("#doctype",10),u.xml_pi?o.insert(e,o.firstChild):c(e)),e.value=u.doctype.substring(9,u.doctype.length-1)):e&&e.remove();e=null;r(o.getAll("meta"),function(n){n.attr("http-equiv")=="Content-Type"&&(e=n)});u.docencoding?(e||(e=new t("meta",1),e.attr("http-equiv","Content-Type"),e.shortEnded=!0,c(e)),e.attr("content","text/html; charset="+u.docencoding)):e.remove();e=o.getAll("title")[0];u.title?(e?e.empty():(e=new t("title",1),c(e)),e.append(new t("#text",3)).value=u.title):e&&e.remove();r("keywords,description,author,copyright,robots".split(","),function(n){for(var s=o.getAll("meta"),r,f=u[n],i=0;i<s.length;i++)if(r=s[i],r.attr("name")==n){f?r.attr("content",f):r.remove();return}f&&(e=new t("meta",1),e.attr("name",n),e.attr("content",f),e.shortEnded=!0,c(e))});l={};tinymce.each(o.getAll("link"),function(n){n.attr("rel")=="stylesheet"&&(l[n.attr("href")]=n)});tinymce.each(u.stylesheets,function(n){l[n]||(e=new t("link",1),e.attr({rel:"stylesheet",text:"text/css",href:n}),e.shortEnded=!0,c(e));delete l[n]});tinymce.each(l,function(n){n.remove()});e=o.getAll("body")[0];e&&(h(e,"dir",u.langdir),h(e,"style",u.style),h(e,"vlink",u.visited_color),h(e,"link",u.link_color),h(e,"alink",u.active_color),y.setAttribs(n.getBody(),{style:u.style,dir:u.dir,vLink:u.visited_color,link:u.link_color,aLink:u.active_color}));e=o.getAll("html")[0];e&&(h(e,"lang",u.langcode),h(e,"xml:lang",u.langcode));s.firstChild||s.remove();a=new tinymce.html.Serializer({validate:!1,indent:!0,apply_source_formatting:!0,indent_before:"head,html,body,meta,title,script,link,style",indent_after:"head,html,body,meta,title,script,link,style"}).serialize(o);i=a.substring(0,a.indexOf("<\/body>"))}function f(){return new tinymce.html.DomParser({validate:!1,root_name:"#document"}).parse(i)}function h(t){function w(n){return n.replace(/<\/?[A-Z]+/g,function(n){return n.toLowerCase()})}var s,h,o=t.content,v,y="",l=n.dom,e,p,a;t.selection||t.format=="raw"&&i||t.source_view&&n.getParam("fullpage_hide_in_source_view")||(o=o.replace(/<(\/?)BODY/gi,"<$1body"),s=o.indexOf("<body"),s!=-1?(s=o.indexOf(">",s),i=w(o.substring(0,s+1)),h=o.indexOf("<\/body",s),h==-1&&(h=o.length),t.content=o.substring(s+1,h),u=w(o.substring(h))):(i=c(),u="\n<\/body>\n<\/html>"),v=f(),r(v.getAll("style"),function(n){n.firstChild&&(y+=n.firstChild.value)}),e=v.getAll("body")[0],e&&l.setAttribs(n.getBody(),{style:e.attr("style")||"",dir:e.attr("dir")||"",vLink:e.attr("vlink")||"",link:e.attr("link")||"",aLink:e.attr("alink")||""}),l.remove("fullpage_styles"),p=n.getDoc().getElementsByTagName("head")[0],y&&(l.add(p,"style",{id:"fullpage_styles"},y),e=l.get("fullpage_styles"),e.styleSheet&&(e.styleSheet.cssText=y)),a={},tinymce.each(p.getElementsByTagName("link"),function(n){n.rel=="stylesheet"&&n.getAttribute("data-mce-fullpage")&&(a[n.href]=n)}),tinymce.each(v.getAll("link"),function(n){var t=n.attr("href");a[t]||n.attr("rel")!="stylesheet"||l.add(p,"link",{rel:"stylesheet",text:"text/css",href:t,"data-mce-fullpage":"1"});delete a[t]}),tinymce.each(a,function(n){n.parentNode.removeChild(n)}))}function c(){var i="",t,r="";return n.getParam("fullpage_default_xml_pi")&&(i+='<?xml version="1.0" encoding="'+n.getParam("fullpage_default_encoding","ISO-8859-1")+'" ?>\n'),i+=n.getParam("fullpage_default_doctype","<!DOCTYPE html>"),i+="\n<html>\n<head>\n",(t=n.getParam("fullpage_default_title"))&&(i+="<title>"+t+"<\/title>\n"),(t=n.getParam("fullpage_default_encoding"))&&(i+='<meta http-equiv="Content-Type" content="text/html; charset='+t+'" />\n'),(t=n.getParam("fullpage_default_font_family"))&&(r+="font-family: "+t+";"),(t=n.getParam("fullpage_default_font_size"))&&(r+="font-size: "+t+";"),(t=n.getParam("fullpage_default_text_color"))&&(r+="color: "+t+";"),i+("<\/head>\n<body"+(r?' style="'+r+'"':"")+">\n")}function l(t){t.selection||t.source_view&&n.getParam("fullpage_hide_in_source_view")||(t.content=tinymce.trim(i)+"\n"+tinymce.trim(t.content)+"\n"+tinymce.trim(u))}var r=tinymce.each,t=tinymce.html.Node,i,u;n.addCommand("mceFullPageProperties",e);n.addButton("fullpage",{title:"Document properties",cmd:"mceFullPageProperties"});n.addMenuItem("fullpage",{text:"Document properties",cmd:"mceFullPageProperties",context:"file"});n.on("BeforeSetContent",h);n.on("GetContent",l)});
/*
//# sourceMappingURL=plugin.min.js.map
*/